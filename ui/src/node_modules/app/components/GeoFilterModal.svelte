<script>
	import {getKey, values} from 'lamb';

	import IconSquare from 'app/components/icons/IconSquare.svelte';
	import IconCheckSquare from 'app/components/icons/IconCheckSquare.svelte';
	import {
		deselectAllRegions,
		preselectedNUTS1IdStore,
		selectAllRegions,
		selectRegionNUTS1,
		toggleRegionNUTS1
	} from 'app/stores';

	const noop = () => {};

	export let nutsSelectionStore;

	$: regions = values($nutsSelectionStore);

	const onMouseEnter = id => () => {
		$preselectedNUTS1IdStore = id;
	}
	const onMouseLeave = id => () => {
		$preselectedNUTS1IdStore = null;
	}
	const onClick = id => () => {
		toggleRegionNUTS1(id);
	}
</script>

<div
	class='clickable modal'
	on:click
>
	<div
		class='panel'
		on:click|stopPropagation={noop}
	>
		<h2>NUTS1 regions</h2>
		<ul>
			{#each regions as {id, name, selected}}
			<li
				class='clickable'
				on:click={onClick(id)}
				on:mouseenter={onMouseEnter(id)}
				on:mouseleave={onMouseLeave(id)}
			>
				<span class='checker'>
					{#if selected}
					<IconCheckSquare size={20} />
					{:else}
					<IconSquare size={20} />
					{/if}
				</span>
				<span>{name}</span>
			</li>
			{/each}

			<li
				class='end sep clickable'
				on:click={() => selectAllRegions()}
			>
				<span>Select all</span>
				<span class='checker'>
					<IconCheckSquare size={20} stroke='palegreen' />
				</span>
			</li>
			<li
				class='end clickable'
				on:click={() => deselectAllRegions()}
			>
				<span>Deselect all</span>
				<span class='checker'>
					<IconSquare size={20} stroke='red' />
				</span>
			</li>
		</ul>
	</div>
</div>

<style>
	.modal {
		align-items: flex-start;
		background-color: rgba(255, 255, 255, 0.25);
		cursor: pointer;
		display: flex;
		height: 100%;
		justify-content: flex-start;
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
	}

	.panel {
		background-color: white;
		border: 1px solid lightgrey;
		box-shadow: var(--box-shadow-xy);
		max-height: 80%;
		max-width: 800px;
		padding: 1rem;
		overflow-y: auto;
		cursor: auto;
	}

	ul {
		width: 100%;
	}

	li {
		width: 100%;
		display: flex;
		align-items: center;
		/* justify-content: space-between; */
	}

	li.end {
		justify-content: flex-end;
	}
	li.sep {
		margin-top: 0.5rem;
	}

	li:hover {
		background-color: rgba(200,200,200,0.2);
	}

	.checker {
		margin-right: 0.5rem;
	}

	li.end .checker {
		margin: 0 0 0 0.5rem;
	}
</style>
