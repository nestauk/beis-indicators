<script>
	import {_screen} from '@svizzle/ui/src/gauges/screen/ScreenGauge.svelte';
	import Link from '@svizzle/ui/src/Link.svelte';
	import LinkButton from '@svizzle/ui/src/LinkButton.svelte';

	import theme from 'app/theme';
	import {
		allNUTS2IndicatorsCsvName,
		availableDownloadIds,
		basename,
	} from 'app/utils/assets';
	import {version} from 'app/utils/version';

	const choroplethURL = 'https://en.wikipedia.org/wiki/Choropleth';
	const csvWikiURL = 'https://en.wikipedia.org/wiki/Comma-separated_values';
	const maxIndex = availableDownloadIds.length - 1;

	const linkTheme = {
		color: theme.colorLink,
		iconStroke: theme.colorLink,
	};
</script>

<section class={$_screen?.classes}>
	<h2>Exploring the indicators</h2>

	<h3>Indicators page</h3>

	<p>
		Apart from the main navigation bar explained
		<Link
			href='/guides/app'
			isBold={true}
			theme={linkTheme}
		>
			here
		</Link>
		, the page is divided in two areas:
	</p>
	<ul>
		<li>in the upper part, there's the content area;</li>
		<li>
			in the lower part, there's a navigation bar:
			<ul>
				<li>clicking on the list icon shows a sidebar</li>
				<li>
					clicking on the clock icon shows the indicators
					distribution.
				</li>
			</ul>
		</li>
	</ul>

	<h4>Sidebar</h4>

	<p>
		Here you will find a list of indicators, grouped by theme sections.
		These are:
	</p>
	<ul>
		<li>Public R&amp;D</li>
		<li>Knowledge exchange and university commercialisation</li>
		<li>Private R&amp;D</li>
		<li>Places attracting R&amp;D firms and workers</li>
	</ul>
	<p>
		Clicking on the name of an indicator will navigate to the trend page
		for that indicator.
	</p>

	<h4>Temporal distribution</h4>

	<p>
		On the upper part you can see a representation of the temporal
		coverage for each available indicator.
	</p>
	<p>
		Each circle represents that data for an indicator is available for
		that year.
	</p>
	<p>
		Click on it to the navigate to that indicator for that specific
		year.
	</p>

	<h4>Timeline</h4>

	<p>
		On the lower part, the timeline shows a list of all years where
		there is data available for at least one indicator.
	</p>

	<h3>Trends page</h3>

	<p>
		Apart from the main navigation bar explained above, the page is
		divided in two areas:
	</p>
	<ul>
		<li>in the upper part, there's the content area;</li>
		<li>
			in the lower part, there's a navigation bar:
			<ul>
				<li>clicking on the list icon shows a sidebar;</li>
				<li>
					clicking on the pulse icon shows the selected indicator
					trends;
				</li>
				<li>
					clicking on the info icon shows the metadata of the
					selected indicator;
				</li>
				<li>clicking on the gear icon shows the settings page.</li>
			</ul>
		</li>
	</ul>

	<h4>Trends</h4>

	<p>
		Here you will see a set of trend lines, with each line showing the
		indicator value for one NUTS2 region over time (where data is
		available).
	</p>
	<p>
		Hovering over a trend line highlights the trend and shows the value
		of the data point nearest to the pointer.
	</p>

	<h4>Timeline</h4>

	<p>
		The Timeline shows one white dot for each year that the indicator is
		available. In this view, the timeline is interactive. Clicking on a
		dot navigates to a map showing the geographic distribution of the
		indicator for that year.
	</p>

	<h4>Indicator metadata and download</h4>

	<p>This view shows:</p>
	<ul>
		<li>
			the indicator metadata (data provenance, date of processing,
			etc);
		</li>
		<li>
			a button to download a
			<Link
				href={csvWikiURL}
				isBold={true}
				theme={linkTheme}
				type='external'
			>
				CSV file
			</Link>
			of the current indicator.
		</li>
	</ul>

	<h4>Settings</h4>

	<p>Here you can find three sections:</p>
	<ul>
		<li>regional selection,</li>
		<li>color scale,</li>
		<li>Y scale.</li>
	</ul>

	<h5>Regional selection</h5>

	<p>
		The trend lines shown correspond to NUTS2 regions, however it is
		possible to select and filter regions based on the larger NUTS1
		regions, of which they are a part. This is particularly useful for
		clarity when focusing on specific regions and also because NUTS1
		regions don't vary over time whereas NUTS2 regions do.
	</p>
	<p>By default all NUTS2 regions are selected.</p>
	<p>
		The selected NUTS2 regions can be highlighted or filtered using the
		switch in the first section:
	</p>
	<ul>
		<li>
			highlighting is useful to focus the attention on the trends for
			the desired regions while still being able to see them all;
		</li>
		<li>
			filtering is useful to isolate trends for the desired regions.
			When filtering, the colour scale on the left is updated to
			reflect only the values of the active trends.
		</li>
	</ul>

	<h5>Color scale</h5>

	<p>
		We provide two color scales for your convenience, that you can set
		using the switch in this section.
	</p>

	<h5>Y scale</h5>

	<p>
		You can use the switch in this section to choose between showing
		absolute values or the values of the region rank: this second mode
		helps seeing how a region changed its positioning relatively to
		other regions.
	</p>

	<h3>Geographic distribution page</h3>

	<p>
		This page can be reached either by clicking on a dot in the
		Indicators page or by clicking on one of the dots of the timeline
		when looking at the trend for a particular indicator.
	</p>
	<p>
		Apart from the main navigation bar explained above, the page is
		divided in two areas:
	</p>
	<ul>
		<li>in the upper part, there's the content area;</li>
		<li>
			in the lower part, there's a navigation bar:
			<ul>
				<li>
					clicking on the baloon icon shows a map of the selected
					indicator values;
				</li>
				<li>
					clicking on the &quot;sorted list&quot; icon shows a bar
					chart of the selected indicator values;
				</li>
				<li>
					clicking on the info icon shows the metadata of the
					selected indicator;
				</li>
				<li>clicking on the gear icon shows the settings page.</li>
			</ul>
		</li>
	</ul>

	<h4>Map</h4>

	<p>
		The <Link
			href={choroplethURL}
			isBold={true}
			theme={linkTheme}
			type='external'
		>
			choropleth
		</Link>
		in this view shows the indicator values on a map of the UK for the
		NUTS2 regions in the selected year.
	</p>
	<p>
		Gray regions indicate that there is no data available for that
		region.
	</p>
	<p>
		The map shows cities with the most research intensive universities
		(those in &quot;TRAC peer group A&quot;). This group has been chosen
		due to its key relevance for BEIS regional policies.
	</p>

	<h4>Bar chart</h4>

	<p>
		The bar chart in this view shows the indicator values for each NUTS2
		region in descending order.
	</p>
	<p>
		The national average is also shown, represented by a vertical dashed
		line. This is calculated as the mean of all available values within
		the year shown.
	</p>

	<h4>Indicator metadata and download</h4>

	<p>Please see the explainer in the correspondent section above.</p>

	<h4>Settings</h4>

	<p>Here you can find two sections:</p>
	<ul>
		<li>regional selection,</li>
		<li>color scale.</li>
	</ul>
	<p>These are the same as explained above.</p>

	<h3>Downloading all indicators</h3>

	<p>You can download all data in the tool for your own use.</p>
	<p>
		Please click on the hamburger and then on the download icon in the
		menu that appears to download a zip file containing the CSV files of
		all of the indicators.
	</p>
	<p>
		That zip file also contains an extra CSV file (titled
		<code>{allNUTS2IndicatorsCsvName}</code> containing all datapoints of all
		indicators in a single file.
	</p>

	<h4>Extras</h4>

	<p>
		Some indicators have been created for NUTS3 and LEP, but these are
		not provided in the tool, nor they are official and should be
		considered as non-official extras:
		{#each availableDownloadIds as availableId, index}
			<Link
				download
				href='/data/{basename}_{availableId}.csv'
				isBold={true}
				theme={linkTheme}
			>
				{availableId}
			</Link>
			{#if index < maxIndex},{/if}
		{/each}.
	</p>

	<h3>Version, changelog and feedback</h3>

	<p>
		Please click on the hamburger then find the app version number of
		the tool (currently <code>{version}</code>).
	</p>
	<p>
		Clicking on the it will navigate to a list of all the notable
		changes introduced in each version of the tool on GitHub.
	</p>
	<p>
		Should you find bugs or have ideas about how to enhance this tool,
		<Link
			href='info/feedback'
			isBold={true}
			theme={linkTheme}
		>
			here
		</Link>
		you can find a short survey and our contact details to post your
		feedback.
	</p>

	<div class='cta'>
		<LinkButton
			href='/accessibility'
			text='Read the accessibility statement'
			theme={{backgroundColor: theme.colorLink}}
		/>
	</div>
	<div class='cta'>
		<LinkButton
			href='/indicators'
			text='Explore the indicators'
			theme={{backgroundColor: theme.colorLink}}
		/>
	</div>
</section>

<style>
	section {
		background-color: white;
		overflow-y: auto;
	}

	h2 {
		font-weight: normal;
		margin-bottom: 1.5rem;
		margin-top: 1.5rem;
	}
	h3 {
		font-weight: normal;
		margin-top: 1.5rem;
	}
	h4 {
		color: var(--color-main);
		font-style: italic;
	}

	p {
		margin: 0.75rem 0;
	}

	ul {
		padding: 0.5rem 0 0.5rem 2rem;
	}

	code {
		font-family: "Courier new", monospace;
	}

	.cta {
		display: flex;
		flex-direction: column;
		justify-content: space-around;
		margin: 4rem 0 3rem 0;
		row-gap: 1em;
	}

	.large .cta {
		flex-direction: row;
		row-gap: 0;
	}
</style>
