import { derived, writable } from 'svelte/store';
import { linearScale } from 'yootils';

import {lookup, yearExtent} from './data/groups';

/* groups */

export const lookupStore = writable(lookup);

/* layout */

export const safetyDefault = {left: 80, right: 80};
export const safetyStore = writable(safetyDefault);
export const resetSafetyStore = () => {
  safetyStore.set(safetyDefault);
}

export const timelineHeightStore = writable(0);
export const timelineWidthStore = writable(0);

export const timelineLayoutStore = derived([
  timelineHeightStore,
  timelineWidthStore,
  safetyStore
], ([height, width, safety]) => {
  const padding = 10;
  const fontSize = Math.min(height / 4, 14);
  const radius = Math.min(height / 8, 7);
  const fullExtent = [
    padding + radius,
    width - padding - radius
  ];
  const fullScaleX = linearScale(yearExtent, fullExtent);
  const start = fullExtent[0] + safety.left;
  const end = fullExtent[1] - safety.right;
  const scaleX = linearScale(yearExtent, [start, end]);
  const y1 = height / 3;
  const y2 = (height + y1 + radius) / 2;
  const ym = height / 2;

  return {
    end,
    fontSize,
    fullScaleX,
    height,
    radius,
    scaleX,
    start,
    width,
    y1,
    y2,
    ym,
  }
});

/* selection */

export const selectedYearStore = writable();
export const resetSelectedYear = () => {
  selectedYearStore.set();
}

export const availableYearsStore = writable([]);

export const resetSelection = () => {
  availableYearsStore.set([]);
  resetSelectedYear();
};
